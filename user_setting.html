<!doctype html>
<html lang="zh-TW">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'>
      <meta name="description" content="">
      <meta name="author" content="sp">
      <meta name="Keywords" content="">
      <title>蝦皮折價券通知</title>
      <!-- Bootstrap core CSS -->
      <link href="bootstrap.min.css" rel="stylesheet">
      <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap-switch-button@1.1.0/css/bootstrap-switch-button.min.css" rel="stylesheet">
      <!-- Favicons -->
      <link rel="icon" href="https://cf.shopee.tw/file/4760f74ce2403a5e161cb95f37e23f16">
      <meta name="msapplication-config" content="/docs/4.4/assets/img/favicons/browserconfig.xml">
      <meta name="theme-color" content="#FCCC04">

      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <script src="popper.min.js"></script>
      <script src="bootstrap.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/1.8.2/countUp.min.js"></script>
      
      <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap-switch-button@1.1.0/dist/bootstrap-switch-button.min.js"></script>
      <script src="https://www.gstatic.com/charts/loader.js"></script>
      <style>
      </style>
        .custom-switch.custom-switch-xl .custom-control-label {
          padding-left: 4rem;
          padding-bottom: 2.5rem;
        }

        .custom-switch.custom-switch-xl .custom-control-label::before {
          height: 2.5rem;
          width: calc(4rem + 0.75rem);
          border-radius: 5rem;
        }

        .custom-switch.custom-switch-xl .custom-control-label::after {
          width: calc(2.5rem - 4px);
          height: calc(2.5rem - 4px);
          border-radius: calc(4rem - (2.5rem / 2));
        }

        .custom-switch.custom-switch-xl .custom-control-input:checked ~ .custom-control-label::after {
          transform: translateX(calc(2.5rem - 0.25rem));
        }
      <script>
        window.onload=Initalize;
        function Initalize(){
          fetch("https://splinemanager1.herokuapp.com/api/line/notify/get?id="+getQueryParams(window.location.search).id, {
            "headers": {
              "accept": "*/*",
              "content-type":"application/json"
            },
            "method": "GET"
            }).then(function(r){
              return r.json()
            }).then(function(jo){
              if(jo['status']=='success'){
                 if(jo['notify']==1){
                   console.log('switch off');
                   $('#switch-notify').get(0).switchButton('off');
                   document.getElementById("switch-notify").checked = false;
                   document.getElementById('switch-notify').switchButton('off');
                 }
                 document.getElementById('revoke-notify').disabled='';
                 document.getElementById('switch-notify').switchButton('enable');
              }
              else{
                bootbox.alert("載入設定失敗", function(){ 
                  window.location.href='https://spvouchernotify.github.io/';
                });
              }
            });
        }
        function revoke() {
        
        }
        $(function() {
          $('#switch-notify').change(function() {
            document.getElementById('switch-notify').switchButton('disable');
            var sw=0;
            if($(this).prop('checked')==true){
              sw=0;
            }
            else{
              sw=1;
            }
            fetch("https://splinemanager1.herokuapp.com/api/line/notify/set?id="+getQueryParams(window.location.search).id+"&notify="+sw, {
              "headers": {
                "accept": "*/*",
                "content-type":"application/json"
              },
              "method": "GET"
              }).then(function(r){
                return r.json()
              }).then(function(jo){
                if(jo['status']=='success'){
                }
                else{
                  bootbox.alert("設定失敗，請稍後再試", function(){ });
                  if(sw==1){
                    document.getElementById('switch-notify').switchButton('on');
                  }
                  else{
                    document.getElementById('switch-notify').switchButton('off');
                  }
                }
                document.getElementById('switch-notify').switchButton('enable');
            });
             
             
          })
        })

        function getQueryParams(qs) {
          qs = qs.split('+').join(' ');
          var params = {},tokens,re = /[?&]?([^=]+)=([^&]*)/g;
          while (tokens = re.exec(qs)) {
            params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
          }
          return params;
        }
      </script>
   </head>
   <body>
      <!-- Google Tag Manager (noscript) -->
      <noscript>
         <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TF8MJ4W" height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
      <!-- End Google Tag Manager (noscript) -->
      <main role="main">
         <section class="jumbotron text-center">
            <div class="container" style="max-width:500px">
               <img class="mb-4" src="https://cf.shopee.tw/file/4760f74ce2403a5e161cb95f37e23f16" alt="" width="72" height="72">
               <h1 class="h3 mb-3 font-weight-normal">使用者設定</h1>
               
               <p></p>
               <h5>通知音提醒:</h5>
               <!--<div class="custom-control custom-switch custom-switch-xl">
                 <input type="checkbox" class="custom-control-input" id="switch-notify" checked>
               </div>-->
               <input type="checkbox" data-toggle="switchbutton" id="switch-notify" data-toggle="switchbutton" checked disabled data-width="100"
               <p></p>
               <button class="btn btn-lg btn-danger btn-block" id="revoke-notify" onclick="" disabled type="button">註銷推播通知</button>
            </div>
         </section>
         
      </main>
      <footer class="text-muted">
         <div class="container">
            <p></p>
            <p></p>
            <p class="float-right">
               <a href="#">Back to top</a>
            </p>
            <p></p>
            <p></p>
         </div>
      </footer>
   </body>
</html>
